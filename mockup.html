<link rel="stylesheet"type="text/css" href="mockup.css">
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300' rel='stylesheet' type='text/css'>

<div class="profBox" id="emptyBox">
    <div class="profName">An Empty Name
    </div>
    <div class="profMetricsWrapper">
        <div class="profMetricsHeader">
            <div class="profScore">Avg. Score</div>
            <div class="profAvgGrade">Avg. Grade</div>
        </div>
        <div class="profMetric">
            <div class="profScore metricScore"></div>
            <div class="profAvgGrade metricGrade"></div>
        </div>
        <div class="showReviews">
            Reviews
        </div>
    </div>
    
    <section class="reviewsWrapper">
        <div class="review">
            <div class="reviewHeader">
                <div class="reviewHeaderClass"> 
                    <div class="reviewDate"></div>
                </div>
                <div class="reviewScore"></div>
            </div>
            <div class="reviewText">
            </div>
            <div class="reviewTextBook"></div>
        </div>
        </div>
    </section>
</div>



<div class="profBox" id="emptyBox">
    <div class="profName">
		<a class="profLink" href="" target="_blank">No information found</a>
    </div>
    <div class="profMetricsWrapper">
        <div class="profMetricsHeader">
            <div class="profScore">Avg. Score</div>
            <div class="profAvgGrade">Avg. Grade</div>
        </div>
        <div class="profMetric">
            <div class="profScore metricScore">n/a</div>
            <div class="profAvgGrade metricGrade">n/a</div>
        </div>
        <div class="showReviews">
            Reviews
        </div>
    </div>
</div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="data.js"></script>
<script>
    

$(".showReviews").on("click",function(e){
        console.log("gg");
        var parent = e.target.parentElement.parentElement;
        if(e.target.clicked == undefined){
            e.target.clicked = true;
            parent.setAttribute("style","height:auto"); 
        }else{
            e.target.clicked = undefined;
            parent.setAttribute("style","height:105px"); 
        }
})

function runTest(){
    for(var prof in testProfs){
        var size = testProfs[prof].length;
            for(var i=0; i<size; i++){
            var response = {prof:testProfs[prof][i]};
            var node = createInfoNode2(response);
            $("body").append(node);
        }
    }
}
runTest()


function createInfoNode2(response){
    var prof = response.prof;
    if(prof == undefined)
        return blankNode();
    var profBox = 
    ["<div class='profBox'>",
        "<div class='profName'>",
        "<a class='profLink' href='","http://",prof["link"].replace(" ","")
        ,"' target=_blank>",prof.name,
        "</a>",
        "</div>",
        "<div class='profMetricsWrapper'>",
            "<div class='profMetricsHeader'>",
                "<div class='profScore'>Avg. Score</div>"
                ,"<div class='profAvgGrade'>Avg. Grade</div>"
            ,"</div>"
            ,"<div class='profMetric'>",
                "<div class='profScore metricScore'>",
                prof.metrics.rating
                ,"</div>"
                ,"<div class='profAvgGrade metricGrade'>",
                prof.metrics.avgGrade
                ,"</div>"
            ,"</div>",
            "<div class='showReviews' onclick='reviewsHandler()'>Reviews</div>"
        ,"</div>",
        "<section class='reviewsWrapper'>"
        ]
        
        // Add reviews
        for(var review in prof.reviews){
            review = prof.reviews[review];
	        profBox.push("<div class='review'>");
	        profBox.push("<div class='reviewHeader'>");
	        profBox.push("<div class='reviewHeaderClass'>");
	        profBox.push(review.class);
	        profBox.push("<div class='reviewDate'>");
	        profBox.push(review.date);
	        profBox.push("</div></div><div class='reviewScore'>");
	        profBox.push(review.score);
	        profBox.push("</div></div>");
	        profBox.push("<div class='reviewText'>");
	        profBox.push(review.review);
	        profBox.push("</div>");
	        profBox.push("<div class='reviewTextBook'>")
	        profBox.push(review.textBook);
	        profBox.push("</div></div>");
        }
        
        // Finish
        profBox.push("</section>")
        profBox.push("</div>")
        return profBox.join("");
}


function createInfoNode(response){
	var prof = response.prof;
	var profBox = createDiv("profBox");
	var profName = createDiv("profName");
	addText(profName,prof.name);
	var profLink = createDiv("profLink","a");
	profLink.setAttribute("href",prof["link"]);
	profLink.setAttribute("target","_blank");
	profLink.appendChild(profName);
	
	var profMetricsWrapper = createDiv("profMetricsWrapper");
	var profMetricsHeader = createDiv("profMetricsHeader");
	var profScore = createDiv("profScore");
	addText(profScore,"Avg. Score");
	var profAvgGrade = createDiv("profAvgGrade");
	addText(profAvgGrade,"Avg. Grade");
	var profMetric = createDiv("profMetric");
	var metricScore= createDiv("profScore metricScore");
	addText(metricScore,prof.metrics.rating);
	var metricGrade = createDiv("profAvgGrade metricGrade");
	addText(metricGrade,prof.metrics.avgGrade);
	var showReviews = createDiv("showReviews");
	addText(showReviews,"Reviews");
	showReviews.addEventListener("click",reviewsHandler);
	var reviewsWrapper = createDiv("reviews","section")
	
	profBox.appendChild(profLink);
	profBox.appendChild(profMetricsWrapper);
	profBox.appendChild(reviewsWrapper);
	profMetricsWrapper.appendChild(profMetricsHeader);
	profMetricsWrapper.appendChild(profMetric);
	profMetricsWrapper.appendChild(showReviews);
	profMetricsHeader.appendChild(profScore);
	profMetricsHeader.appendChild(profAvgGrade);
	profMetric.appendChild(metricScore);
	profMetric.appendChild(metricGrade);
	
	
	for(var review in prof.reviews){
	    review = prof.reviews[review];
		var reviewNode = createDiv("review");
	 	var reviewHeader = createDiv("reviewHeader");
	 	var reviewHeaderClass = createDiv("reviewHeaderClass");
	 	addText(reviewHeaderClass,review.class);
	 	var reviewDate = createDiv("reviewDate");
	 	addText(reviewDate,review.date);
	 	var reviewScore = createDiv("reviewScore");
	 	addText(reviewScore,review.score);
	 	var reviewText = createDiv("reviewText");
	 	addText(reviewText,review.review);
	 	var reviewTextBook = createDiv("reviewTextBook");
	 	addText(reviewTextBook,review.textbook);
	 	reviewsWrapper.appendChild(reviewNode);
	 	reviewNode.appendChild(reviewHeader);
	 	reviewNode.appendChild(reviewText);
	 	reviewNode.appendChild(reviewTextBook);
	 	reviewHeader.appendChild(reviewHeaderClass);
	 	reviewHeaderClass.appendChild(reviewDate);
	 	reviewHeader.appendChild(reviewScore);
	}
	return profBox;
}


    
function createDiv(_class,tag){
	if(tag === undefined)
		tag = "div";
	var node = document.createElement(tag);
	node.className = _class;
	return node;
}

function addText(div,text){
    var textNode = document.createTextNode(text);
    div.appendChild(textNode);
}
    
function reviewsHandler(){
	var parent = event.target.parentElement.parentElement;
    if(event.target.clicked == undefined){
    	event.target.clicked = true;
        parent.setAttribute("style","height:auto"); 
    }else{
        event.target.clicked = undefined;
        parent.setAttribute("style","height:105px"); 
    }
}

</script>